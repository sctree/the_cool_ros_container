/* esm.sh - bson@6.10.4 */
import { Buffer as __Buffer$ } from "node:buffer";
import{randomBytes as Xe}from"node:crypto";var Qe=(()=>{let e=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Uint8Array.prototype),Symbol.toStringTag).get;return t=>e.call(t)})();function ot(e){return Qe(e)==="Uint8Array"}function ee(e){return typeof e=="object"&&e!=null&&Symbol.toStringTag in e&&(e[Symbol.toStringTag]==="ArrayBuffer"||e[Symbol.toStringTag]==="SharedArrayBuffer")}function ft(e){return e instanceof RegExp||Object.prototype.toString.call(e)==="[object RegExp]"}function ne(e){return typeof e=="object"&&e!=null&&Symbol.toStringTag in e&&e[Symbol.toStringTag]==="Map"}function lt(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function x(e,t){return JSON.stringify(e,(r,n)=>typeof n=="bigint"?{$numberLong:`${n}`}:ne(n)?Object.fromEntries(n):n)}function ve(e){if(e!=null&&typeof e=="object"&&"stylize"in e&&typeof e.stylize=="function")return e.stylize}var v=6,at=Symbol.for("@@mdb.bson.version"),Et=2147483647,Ot=-2147483648,Ie=Math.pow(2,63)-1,Te=-Math.pow(2,63),Le=Math.pow(2,53),$e=-Math.pow(2,53),re=1,Ae=2,ie=3,Ue=4,se=5,tn=6,_e=7,Re=8,De=9,oe=10,$t=11,en=12,fe=13,ze=14,je=15,St=16,xe=17,le=18,Fe=19,Me=255,Pe=127,nn=0,ce=4,rn=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127}),c=class extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(t,r){super(t,r)}static isBSONError(t){return t!=null&&typeof t=="object"&&"bsonError"in t&&t.bsonError===!0&&"name"in t&&"message"in t&&"stack"in t}},q=class extends c{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${v}.x.x`)}},Bt=class extends c{get name(){return"BSONRuntimeError"}constructor(t){super(t)}},V=class extends c{get name(){return"BSONOffsetError"}constructor(t,r,n){super(`${t}. offset: ${r}`,n),this.offset=r}},he,ae;function Ce(e,t,r,n){if(n){he??=new TextDecoder("utf8",{fatal:!0});try{return he.decode(e.subarray(t,r))}catch(i){throw new c("Invalid UTF-8 string in BSON document",{cause:i})}}return ae??=new TextDecoder("utf8",{fatal:!1}),ae.decode(e.subarray(t,r))}function Ve(e,t,r){if(e.length===0)return"";let n=r-t;if(n===0)return"";if(n>20)return null;if(n===1&&e[t]<128)return String.fromCharCode(e[t]);if(n===2&&e[t]<128&&e[t+1]<128)return String.fromCharCode(e[t])+String.fromCharCode(e[t+1]);if(n===3&&e[t]<128&&e[t+1]<128&&e[t+2]<128)return String.fromCharCode(e[t])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2]);let i=[];for(let s=t;s<r;s++){let h=e[s];if(h>127)return null;i.push(h)}return String.fromCharCode(...i)}function sn(e,t,r){if(t.length===0)return 0;if(t.length>25||e.length-r<t.length)return null;for(let n=0,i=r;n<t.length;n++,i++){let s=t.charCodeAt(n);if(s>127)return null;e[i]=s}return t.length}var W={toLocalBufferType(e){if(__Buffer$.isBuffer(e))return e;if(ArrayBuffer.isView(e))return __Buffer$.from(e.buffer,e.byteOffset,e.byteLength);let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if(t==="ArrayBuffer"||t==="SharedArrayBuffer"||t==="[object ArrayBuffer]"||t==="[object SharedArrayBuffer]")return __Buffer$.from(e);throw new c("Cannot create Buffer from the passed potentialBuffer.")},allocate(e){return __Buffer$.alloc(e)},allocateUnsafe(e){return __Buffer$.allocUnsafe(e)},equals(e,t){return W.toLocalBufferType(e).equals(t)},fromNumberArray(e){return __Buffer$.from(e)},fromBase64(e){return __Buffer$.from(e,"base64")},toBase64(e){return W.toLocalBufferType(e).toString("base64")},fromISO88591(e){return __Buffer$.from(e,"binary")},toISO88591(e){return W.toLocalBufferType(e).toString("binary")},fromHex(e){return __Buffer$.from(e,"hex")},toHex(e){return W.toLocalBufferType(e).toString("hex")},toUTF8(e,t,r,n){let i=r-t<=20?Ve(e,t,r):null;if(i!=null)return i;let s=W.toLocalBufferType(e).toString("utf8",t,r);if(n){for(let h=0;h<s.length;h++)if(s.charCodeAt(h)===65533){Ce(e,t,r,!0);break}}return s},utf8ByteLength(e){return __Buffer$.byteLength(e,"utf8")},encodeUTF8Into(e,t,r){let n=sn(e,t,r);return n??W.toLocalBufferType(e).write(t,r,void 0,"utf8")},randomBytes:Xe,swap32(e){return W.toLocalBufferType(e).swap32()}};function on(){let{navigator:e}=globalThis;return typeof e=="object"&&e.product==="ReactNative"}function fn(e){if(e<0)throw new RangeError(`The argument 'byteLength' is invalid. Received ${e}`);return Nt.fromNumberArray(Array.from({length:e},()=>Math.floor(Math.random()*256)))}var ln=(()=>{let{crypto:e}=globalThis;if(e!=null&&typeof e.getRandomValues=="function")return t=>e.getRandomValues(Nt.allocate(t));if(on()){let{console:t}=globalThis;t?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return fn})(),ue=/(\d|[a-f])/i,Nt={toLocalBufferType(e){let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if(t==="Uint8Array")return e;if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));if(t==="ArrayBuffer"||t==="SharedArrayBuffer"||t==="[object ArrayBuffer]"||t==="[object SharedArrayBuffer]")return new Uint8Array(e);throw new c("Cannot make a Uint8Array from passed potentialBuffer.")},allocate(e){if(typeof e!="number")throw new TypeError(`The "size" argument must be of type number. Received ${String(e)}`);return new Uint8Array(e)},allocateUnsafe(e){return Nt.allocate(e)},equals(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},fromNumberArray(e){return Uint8Array.from(e)},fromBase64(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))},toBase64(e){return btoa(Nt.toISO88591(e))},fromISO88591(e){return Uint8Array.from(e,t=>t.charCodeAt(0)&255)},toISO88591(e){return Array.from(Uint16Array.from(e),t=>String.fromCharCode(t)).join("")},fromHex(e){let t=e.length%2===0?e:e.slice(0,e.length-1),r=[];for(let n=0;n<t.length;n+=2){let i=t[n],s=t[n+1];if(!ue.test(i)||!ue.test(s))break;let h=Number.parseInt(`${i}${s}`,16);r.push(h)}return Uint8Array.from(r)},toHex(e){return Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")},toUTF8(e,t,r,n){let i=r-t<=20?Ve(e,t,r):null;return i??Ce(e,t,r,n)},utf8ByteLength(e){return new TextEncoder().encode(e).byteLength},encodeUTF8Into(e,t,r){let n=new TextEncoder().encode(t);return e.set(n,r),n.byteLength},randomBytes:ln,swap32(e){if(e.length%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e.length;t+=4){let r=e[t],n=e[t+1],i=e[t+2],s=e[t+3];e[t]=s,e[t+1]=i,e[t+2]=n,e[t+3]=r}return e}},cn=typeof __Buffer$=="function"&&__Buffer$.prototype?._isBuffer!==!0,l=cn?W:Nt,j=class{get[at](){return v}[Symbol.for("nodejs.util.inspect.custom")](t,r,n){return this.inspect(t,r,n)}},ct=new Float64Array(1),A=new Uint8Array(ct.buffer,0,8);ct[0]=-1;var Ut=A[7]===0,O={isBigEndian:Ut,getNonnegativeInt32LE(e,t){if(e[t+3]>127)throw new RangeError(`Size cannot be negative at offset: ${t}`);return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},getInt32LE(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},getUint32LE(e,t){return e[t]+e[t+1]*256+e[t+2]*65536+e[t+3]*16777216},getUint32BE(e,t){return e[t+3]+e[t+2]*256+e[t+1]*65536+e[t]*16777216},getBigInt64LE(e,t){let r=BigInt(e[t+4]+e[t+5]*256+e[t+6]*65536+(e[t+7]<<24)),n=BigInt(e[t]+e[t+1]*256+e[t+2]*65536+e[t+3]*16777216);return(r<<BigInt(32))+n},getFloat64LE:Ut?(e,t)=>(A[7]=e[t],A[6]=e[t+1],A[5]=e[t+2],A[4]=e[t+3],A[3]=e[t+4],A[2]=e[t+5],A[1]=e[t+6],A[0]=e[t+7],ct[0]):(e,t)=>(A[0]=e[t],A[1]=e[t+1],A[2]=e[t+2],A[3]=e[t+3],A[4]=e[t+4],A[5]=e[t+5],A[6]=e[t+6],A[7]=e[t+7],ct[0]),setInt32BE(e,t,r){return e[t+3]=r,r>>>=8,e[t+2]=r,r>>>=8,e[t+1]=r,r>>>=8,e[t]=r,4},setInt32LE(e,t,r){return e[t]=r,r>>>=8,e[t+1]=r,r>>>=8,e[t+2]=r,r>>>=8,e[t+3]=r,4},setBigInt64LE(e,t,r){let n=BigInt(4294967295),i=Number(r&n);e[t]=i,i>>=8,e[t+1]=i,i>>=8,e[t+2]=i,i>>=8,e[t+3]=i;let s=Number(r>>BigInt(32)&n);return e[t+4]=s,s>>=8,e[t+5]=s,s>>=8,e[t+6]=s,s>>=8,e[t+7]=s,8},setFloat64LE:Ut?(e,t,r)=>(ct[0]=r,e[t]=A[7],e[t+1]=A[6],e[t+2]=A[5],e[t+3]=A[4],e[t+4]=A[3],e[t+5]=A[2],e[t+6]=A[1],e[t+7]=A[0],8):(e,t,r)=>(ct[0]=r,e[t]=A[0],e[t+1]=A[1],e[t+2]=A[2],e[t+3]=A[3],e[t+4]=A[4],e[t+5]=A[5],e[t+6]=A[6],e[t+7]=A[7],8)},T=class e extends j{get _bsontype(){return"Binary"}constructor(t,r){if(super(),t!=null&&typeof t=="string"&&!ArrayBuffer.isView(t)&&!ee(t)&&!Array.isArray(t))throw new c("Binary can only be constructed from Uint8Array or number[]");this.sub_type=r??e.BSON_BINARY_SUBTYPE_DEFAULT,t==null?(this.buffer=l.allocate(e.BUFFER_SIZE),this.position=0):(this.buffer=Array.isArray(t)?l.fromNumberArray(t):l.toLocalBufferType(t),this.position=this.buffer.byteLength)}put(t){if(typeof t=="string"&&t.length!==1)throw new c("only accepts single character String");if(typeof t!="number"&&t.length!==1)throw new c("only accepts single character Uint8Array or Array");let r;if(typeof t=="string"?r=t.charCodeAt(0):typeof t=="number"?r=t:r=t[0],r<0||r>255)throw new c("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=r;else{let n=l.allocate(e.BUFFER_SIZE+this.buffer.length);n.set(this.buffer,0),this.buffer=n,this.buffer[this.position++]=r}}write(t,r){if(r=typeof r=="number"?r:this.position,this.buffer.byteLength<r+t.length){let n=l.allocate(this.buffer.byteLength+t.length);n.set(this.buffer,0),this.buffer=n}if(ArrayBuffer.isView(t))this.buffer.set(l.toLocalBufferType(t),r),this.position=r+t.byteLength>this.position?r+t.length:this.position;else if(typeof t=="string")throw new c("input cannot be string")}read(t,r){r=r&&r>0?r:this.position;let n=t+r;return this.buffer.subarray(t,n>this.position?this.position:n)}value(){return this.buffer.length===this.position?this.buffer:this.buffer.subarray(0,this.position)}length(){return this.position}toJSON(){return l.toBase64(this.buffer.subarray(0,this.position))}toString(t){return t==="hex"?l.toHex(this.buffer.subarray(0,this.position)):t==="base64"?l.toBase64(this.buffer.subarray(0,this.position)):t==="utf8"||t==="utf-8"?l.toUTF8(this.buffer,0,this.position,!1):l.toUTF8(this.buffer,0,this.position,!1)}toExtendedJSON(t){t=t||{},this.sub_type===e.SUBTYPE_VECTOR&&J(this);let r=l.toBase64(this.buffer),n=Number(this.sub_type).toString(16);return t.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}}toUUID(){if(this.sub_type===e.SUBTYPE_UUID)return new tt(this.buffer.subarray(0,this.position));throw new c(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${e.SUBTYPE_UUID}" is currently supported.`)}static createFromHexString(t,r){return new e(l.fromHex(t),r)}static createFromBase64(t,r){return new e(l.fromBase64(t),r)}static fromExtendedJSON(t,r){r=r||{};let n,i;if("$binary"in t?r.legacy&&typeof t.$binary=="string"&&"$type"in t?(i=t.$type?parseInt(t.$type,16):0,n=l.fromBase64(t.$binary)):typeof t.$binary!="string"&&(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=l.fromBase64(t.$binary.base64)):"$uuid"in t&&(i=4,n=tt.bytesFromString(t.$uuid)),!n)throw new c(`Unexpected Binary Extended JSON format ${JSON.stringify(t)}`);return i===ce?new tt(n):new e(n,i)}inspect(t,r,n){n??=x;let i=l.toBase64(this.buffer.subarray(0,this.position)),s=n(i,r),h=n(this.sub_type,r);return`Binary.createFromBase64(${s}, ${h})`}toInt8Array(){if(this.sub_type!==e.SUBTYPE_VECTOR)throw new c("Binary sub_type is not Vector");if(this.buffer[0]!==e.VECTOR_TYPE.Int8)throw new c("Binary datatype field is not Int8");return J(this),new Int8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position))}toFloat32Array(){if(this.sub_type!==e.SUBTYPE_VECTOR)throw new c("Binary sub_type is not Vector");if(this.buffer[0]!==e.VECTOR_TYPE.Float32)throw new c("Binary datatype field is not Float32");J(this);let t=new Uint8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position));return O.isBigEndian&&l.swap32(t),new Float32Array(t.buffer)}toPackedBits(){if(this.sub_type!==e.SUBTYPE_VECTOR)throw new c("Binary sub_type is not Vector");if(this.buffer[0]!==e.VECTOR_TYPE.PackedBit)throw new c("Binary datatype field is not packed bit");return J(this),new Uint8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position))}toBits(){if(this.sub_type!==e.SUBTYPE_VECTOR)throw new c("Binary sub_type is not Vector");if(this.buffer[0]!==e.VECTOR_TYPE.PackedBit)throw new c("Binary datatype field is not packed bit");J(this);let r=(this.length()-2)*8-this.buffer[1],n=new Int8Array(r);for(let i=0;i<n.length;i++){let s=i/8|0,h=this.buffer[s+2],a=7-i%8,o=h>>a&1;n[i]=o}return n}static fromInt8Array(t){let r=l.allocate(t.byteLength+2);r[0]=e.VECTOR_TYPE.Int8,r[1]=0;let n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);r.set(n,2);let i=new this(r,this.SUBTYPE_VECTOR);return J(i),i}static fromFloat32Array(t){let r=l.allocate(t.byteLength+2);r[0]=e.VECTOR_TYPE.Float32,r[1]=0;let n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);r.set(n,2),O.isBigEndian&&l.swap32(new Uint8Array(r.buffer,2));let i=new this(r,this.SUBTYPE_VECTOR);return J(i),i}static fromPackedBits(t,r=0){let n=l.allocate(t.byteLength+2);n[0]=e.VECTOR_TYPE.PackedBit,n[1]=r,n.set(t,2);let i=new this(n,this.SUBTYPE_VECTOR);return J(i),i}static fromBits(t){let r=t.length+7>>>3,n=new Uint8Array(r+2);n[0]=e.VECTOR_TYPE.PackedBit;let i=t.length%8;n[1]=i===0?0:8-i;for(let s=0;s<t.length;s++){let h=s>>>3,a=t[s];if(a!==0&&a!==1)throw new c(`Invalid bit value at ${s}: must be 0 or 1, found ${t[s]}`);if(a===0)continue;let o=7-s%8;n[h+2]|=a<<o}return new this(n,e.SUBTYPE_VECTOR)}};T.BSON_BINARY_SUBTYPE_DEFAULT=0;T.BUFFER_SIZE=256;T.SUBTYPE_DEFAULT=0;T.SUBTYPE_FUNCTION=1;T.SUBTYPE_BYTE_ARRAY=2;T.SUBTYPE_UUID_OLD=3;T.SUBTYPE_UUID=4;T.SUBTYPE_MD5=5;T.SUBTYPE_ENCRYPTED=6;T.SUBTYPE_COLUMN=7;T.SUBTYPE_SENSITIVE=8;T.SUBTYPE_VECTOR=9;T.SUBTYPE_USER_DEFINED=128;T.VECTOR_TYPE=Object.freeze({Int8:3,Float32:39,PackedBit:16});function J(e){if(e.sub_type!==T.SUBTYPE_VECTOR)return;let t=e.position,r=e.buffer[0],n=e.buffer[1];if((r===T.VECTOR_TYPE.Float32||r===T.VECTOR_TYPE.Int8)&&n!==0)throw new c("Invalid Vector: padding must be zero for int8 and float32 vectors");if(r===T.VECTOR_TYPE.Float32&&t!==0&&t-2!==0&&(t-2)%4!==0)throw new c("Invalid Vector: Float32 vector must contain a multiple of 4 bytes");if(r===T.VECTOR_TYPE.PackedBit&&n!==0&&t===2)throw new c("Invalid Vector: padding must be zero for packed bit vectors that are empty");if(r===T.VECTOR_TYPE.PackedBit&&n>7)throw new c(`Invalid Vector: padding must be a value between 0 and 7. found: ${n}`)}var _t=16,hn=/^[0-9A-F]{32}$/i,an=/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,tt=class e extends T{constructor(t){let r;if(t==null)r=e.generate();else if(t instanceof e)r=l.toLocalBufferType(new Uint8Array(t.buffer));else if(ArrayBuffer.isView(t)&&t.byteLength===_t)r=l.toLocalBufferType(t);else if(typeof t=="string")r=e.bytesFromString(t);else throw new c("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(r,ce)}get id(){return this.buffer}set id(t){this.buffer=t}toHexString(t=!0){return t?[l.toHex(this.buffer.subarray(0,4)),l.toHex(this.buffer.subarray(4,6)),l.toHex(this.buffer.subarray(6,8)),l.toHex(this.buffer.subarray(8,10)),l.toHex(this.buffer.subarray(10,16))].join("-"):l.toHex(this.buffer)}toString(t){return t==="hex"?l.toHex(this.id):t==="base64"?l.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(t){if(!t)return!1;if(t instanceof e)return l.equals(t.id,this.id);try{return l.equals(new e(t).id,this.id)}catch{return!1}}toBinary(){return new T(this.id,T.SUBTYPE_UUID)}static generate(){let t=l.randomBytes(_t);return t[6]=t[6]&15|64,t[8]=t[8]&63|128,t}static isValid(t){return t?typeof t=="string"?e.isValidUUIDString(t):ot(t)?t.byteLength===_t:t._bsontype==="Binary"&&t.sub_type===this.SUBTYPE_UUID&&t.buffer.byteLength===16:!1}static createFromHexString(t){let r=e.bytesFromString(t);return new e(r)}static createFromBase64(t){return new e(l.fromBase64(t))}static bytesFromString(t){if(!e.isValidUUIDString(t))throw new c("UUID string representation must be 32 hex digits or canonical hyphenated representation");return l.fromHex(t.replace(/-/g,""))}static isValidUUIDString(t){return hn.test(t)||an.test(t)}inspect(t,r,n){return n??=x,`new UUID(${n(this.toHexString(),r)})`}},K=class e extends j{get _bsontype(){return"Code"}constructor(t,r){super(),this.code=t.toString(),this.scope=r??null}toJSON(){return this.scope!=null?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(t){return new e(t.$code,t.$scope)}inspect(t,r,n){n??=x;let i=n(this.code,r),s=i.includes(`
`);this.scope!=null&&(i+=`,${s?`
`:" "}${n(this.scope,r)}`);let h=s&&this.scope===null;return`new Code(${s?`
`:""}${i}${h?`
`:""})`}};function Ye(e){return e!=null&&typeof e=="object"&&"$id"in e&&e.$id!=null&&"$ref"in e&&typeof e.$ref=="string"&&(!("$db"in e)||"$db"in e&&typeof e.$db=="string")}var k=class e extends j{get _bsontype(){return"DBRef"}constructor(t,r,n,i){super();let s=t.split(".");s.length===2&&(n=s.shift(),t=s.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}get namespace(){return this.collection}set namespace(t){this.collection=t}toJSON(){let t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(t.$db=this.db),t}toExtendedJSON(t){t=t||{};let r={$ref:this.collection,$id:this.oid};return t.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r}static fromExtendedJSON(t){let r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)}inspect(t,r,n){n??=x;let i=[n(this.namespace,r),n(this.oid,r),...this.db?[n(this.db,r)]:[],...Object.keys(this.fields).length>0?[n(this.fields,r)]:[]];return i[1]=n===x?`new ObjectId(${i[1]})`:i[1],`new DBRef(${i.join(", ")})`}};function Je(e){if(e==="")return e;let t=0,r=e[t]==="-",n=e[t]==="+";(n||r)&&(t+=1);let i=!1;for(;t<e.length&&e[t]==="0";++t)i=!0;return i?`${r?"-":""}${e.length===t?"0":e.slice(t)}`:n?e.slice(1):e}function un(e,t){t=t??10;let r="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,t);return new RegExp(`[^-+${r}]`,"i").test(e)?!1:e}var M;try{M=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var ge=65536,gn=1<<24,ht=ge*ge,He=ht*ht,yn=He/2,ye={},me={},mn=20,wn=/^(\+?0|(\+|-)?[1-9][0-9]*)$/,y=class e extends j{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(t=0,r,n){super();let i=typeof r=="boolean"?r:!!n,s=typeof r=="number"?r:0,h=typeof t=="string"?e.fromString(t,i):typeof t=="bigint"?e.fromBigInt(t,i):{low:t|0,high:s|0,unsigned:i};this.low=h.low,this.high=h.high,this.unsigned=h.unsigned}static fromBits(t,r,n){return new e(t,r,n)}static fromInt(t,r){let n,i,s;return r?(t>>>=0,(s=0<=t&&t<256)&&(i=me[t],i)?i:(n=e.fromBits(t,(t|0)<0?-1:0,!0),s&&(me[t]=n),n)):(t|=0,(s=-128<=t&&t<128)&&(i=ye[t],i)?i:(n=e.fromBits(t,t<0?-1:0,!1),s&&(ye[t]=n),n))}static fromNumber(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=He)return e.MAX_UNSIGNED_VALUE}else{if(t<=-9223372036854776e3)return e.MIN_VALUE;if(t+1>=yn)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%ht|0,t/ht|0,r)}static fromBigInt(t,r){let n=BigInt(4294967295),i=BigInt(32);return new e(Number(t&n),Number(t>>i&n),r)}static _fromString(t,r,n){if(t.length===0)throw new c("empty string");if(n<2||36<n)throw new c("radix");let i;if((i=t.indexOf("-"))>0)throw new c("interior hyphen");if(i===0)return e._fromString(t.substring(1),r,n).neg();let s=e.fromNumber(Math.pow(n,8)),h=e.ZERO;for(let a=0;a<t.length;a+=8){let o=Math.min(8,t.length-a),N=parseInt(t.substring(a,a+o),n);if(o<8){let g=e.fromNumber(Math.pow(n,o));h=h.mul(g).add(e.fromNumber(N))}else h=h.mul(s),h=h.add(e.fromNumber(N))}return h.unsigned=r,h}static fromStringStrict(t,r,n){let i=!1;if(typeof r=="number"?(n=r,r=!1):i=!!r,n??=10,t.trim()!==t)throw new c(`Input: '${t}' contains leading and/or trailing whitespace`);if(!un(t,n))throw new c(`Input: '${t}' contains invalid characters for radix: ${n}`);let s=Je(t),h=e._fromString(s,i,n);if(h.toString(n).toLowerCase()!==s.toLowerCase())throw new c(`Input: ${t} is not representable as ${h.unsigned?"an unsigned":"a signed"} 64-bit Long ${n!=null?`with radix: ${n}`:""}`);return h}static fromString(t,r,n){let i=!1;return typeof r=="number"?(n=r,r=!1):i=!!r,n??=10,t==="NaN"&&n<24||(t==="Infinity"||t==="+Infinity"||t==="-Infinity")&&n<35?e.ZERO:e._fromString(t,i,n)}static fromBytes(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)}static fromBytesLE(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)}static fromBytesBE(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)}static isLong(t){return t!=null&&typeof t=="object"&&"__isLong__"in t&&t.__isLong__===!0}static fromValue(t,r){return typeof t=="number"?e.fromNumber(t,r):typeof t=="string"?e.fromString(t,r):e.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)}add(t){e.isLong(t)||(t=e.fromValue(t));let r=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,h=t.high>>>16,a=t.high&65535,o=t.low>>>16,N=t.low&65535,g=0,f=0,u=0,b=0;return b+=s+N,u+=b>>>16,b&=65535,u+=i+o,f+=u>>>16,u&=65535,f+=n+a,g+=f>>>16,f&=65535,g+=r+h,g&=65535,e.fromBits(u<<16|b,g<<16|f,this.unsigned)}and(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)}compare(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;let r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1}comp(t){return this.compare(t)}divide(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw new c("division by zero");if(M){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;let s=(this.unsigned?M.div_u:M.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(s,M.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;let r,n,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;i=e.UZERO}else{if(this.eq(e.MIN_VALUE))return t.eq(e.ONE)||t.eq(e.NEG_ONE)?e.MIN_VALUE:t.eq(e.MIN_VALUE)?e.ONE:(r=this.shr(1).div(t).shl(1),r.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(n=this.sub(t.mul(r)),i=r.add(n.div(t)),i));if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=e.ZERO}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));let s=Math.ceil(Math.log(r)/Math.LN2),h=s<=48?1:Math.pow(2,s-48),a=e.fromNumber(r),o=a.mul(t);for(;o.isNegative()||o.gt(n);)r-=h,a=e.fromNumber(r,this.unsigned),o=a.mul(t);a.isZero()&&(a=e.ONE),i=i.add(a),n=n.sub(o)}return i}div(t){return this.divide(t)}equals(t){return e.isLong(t)||(t=e.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low}eq(t){return this.equals(t)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();let t=this.high!==0?this.high:this.low,r;for(r=31;r>0&&(t&1<<r)===0;r--);return this.high!==0?r+33:r+1}greaterThan(t){return this.comp(t)>0}gt(t){return this.greaterThan(t)}greaterThanOrEqual(t){return this.comp(t)>=0}gte(t){return this.greaterThanOrEqual(t)}ge(t){return this.greaterThanOrEqual(t)}isEven(){return(this.low&1)===0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(this.low&1)===1}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(t){return this.comp(t)<0}lt(t){return this.lessThan(t)}lessThanOrEqual(t){return this.comp(t)<=0}lte(t){return this.lessThanOrEqual(t)}modulo(t){if(e.isLong(t)||(t=e.fromValue(t)),M){let r=(this.unsigned?M.rem_u:M.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,M.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))}mod(t){return this.modulo(t)}rem(t){return this.modulo(t)}multiply(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),M){let S=M.mul(this.low,this.high,t.low,t.high);return e.fromBits(S,M.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);let r=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,h=t.high>>>16,a=t.high&65535,o=t.low>>>16,N=t.low&65535,g=0,f=0,u=0,b=0;return b+=s*N,u+=b>>>16,b&=65535,u+=i*N,f+=u>>>16,u&=65535,u+=s*o,f+=u>>>16,u&=65535,f+=n*N,g+=f>>>16,f&=65535,f+=i*o,g+=f>>>16,f&=65535,f+=s*a,g+=f>>>16,f&=65535,g+=r*N+n*o+i*a+s*h,g&=65535,e.fromBits(u<<16|b,g<<16|f,this.unsigned)}mul(t){return this.multiply(t)}negate(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)}neg(){return this.negate()}not(){return e.fromBits(~this.low,~this.high,this.unsigned)}notEquals(t){return!this.equals(t)}neq(t){return this.notEquals(t)}ne(t){return this.notEquals(t)}or(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)}shiftLeft(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)}shl(t){return this.shiftLeft(t)}shiftRight(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)}shr(t){return this.shiftRight(t)}shiftRightUnsigned(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;{let r=this.high;if(t<32){let n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)}}shr_u(t){return this.shiftRightUnsigned(t)}shru(t){return this.shiftRightUnsigned(t)}subtract(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())}sub(t){return this.subtract(t)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*ht+(this.low>>>0):this.high*ht+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(t){return t?this.toBytesLE():this.toBytesBE()}toBytesLE(){let t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]}toBytesBE(){let t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]}toSigned(){return this.unsigned?e.fromBits(this.low,this.high,!1):this}toString(t){if(t=t||10,t<2||36<t)throw new c("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(e.MIN_VALUE)){let s=e.fromNumber(t),h=this.div(s),a=h.mul(s).sub(this);return h.toString(t)+a.toInt().toString(t)}else return"-"+this.neg().toString(t);let r=e.fromNumber(Math.pow(t,6),this.unsigned),n=this,i="";for(;;){let s=n.div(r),a=(n.sub(s.mul(r)).toInt()>>>0).toString(t);if(n=s,n.isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}}toUnsigned(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)}xor(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)}eqz(){return this.isZero()}le(t){return this.lessThanOrEqual(t)}toExtendedJSON(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(t,r){let{useBigInt64:n=!1,relaxed:i=!0}={...r};if(t.$numberLong.length>mn)throw new c("$numberLong string is too long");if(!wn.test(t.$numberLong))throw new c(`$numberLong string "${t.$numberLong}" is in an invalid format`);if(n){let h=BigInt(t.$numberLong);return BigInt.asIntN(64,h)}let s=e.fromString(t.$numberLong);return i?s.toNumber():s}inspect(t,r,n){n??=x;let i=n(this.toString(),r),s=this.unsigned?`, ${n(this.unsigned,r)}`:"";return`new Long(${i}${s})`}};y.TWO_PWR_24=y.fromInt(gn);y.MAX_UNSIGNED_VALUE=y.fromBits(-1,-1,!0);y.ZERO=y.fromInt(0);y.UZERO=y.fromInt(0,!0);y.ONE=y.fromInt(1);y.UONE=y.fromInt(1,!0);y.NEG_ONE=y.fromInt(-1);y.MAX_VALUE=y.fromBits(-1,2147483647,!1);y.MIN_VALUE=y.fromBits(0,-2147483648,!1);var bn=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,pn=/^(\+|-)?(Infinity|inf)$/i,Sn=/^(\+|-)?NaN$/i,it=6111,bt=-6176,we=6176,be=34,Rt=l.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),pe=l.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Se=l.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Bn=/^([-+])?(\d+)?$/,Nn=31,Be=16383,En=30,On=31;function Ne(e){return!isNaN(parseInt(e,10))}function dn(e){let t=y.fromNumber(1e9),r=y.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:r};for(let n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new y(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function In(e,t){if(!e&&!t)return{high:y.fromNumber(0),low:y.fromNumber(0)};let r=e.shiftRightUnsigned(32),n=new y(e.getLowBits(),0),i=t.shiftRightUnsigned(32),s=new y(t.getLowBits(),0),h=r.multiply(i),a=r.multiply(s),o=n.multiply(i),N=n.multiply(s);return h=h.add(a.shiftRightUnsigned(32)),a=new y(a.getLowBits(),0).add(o).add(N.shiftRightUnsigned(32)),h=h.add(a.shiftRightUnsigned(32)),N=a.shiftLeft(32).add(new y(N.getLowBits(),0)),{high:h,low:N}}function Tn(e,t){let r=e.high>>>0,n=t.high>>>0;if(r<n)return!0;if(r===n){let i=e.low>>>0,s=t.low>>>0;if(i<s)return!0}return!1}function C(e,t){throw new c(`"${e}" is not a valid Decimal128 string - ${t}`)}var ut=class e extends j{get _bsontype(){return"Decimal128"}constructor(t){if(super(),typeof t=="string")this.bytes=e.fromString(t).bytes;else if(t instanceof Uint8Array||ot(t)){if(t.byteLength!==16)throw new c("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}else throw new c("Decimal128 must take a Buffer or string")}static fromString(t){return e._fromString(t,{allowRounding:!1})}static fromStringWithRounding(t){return e._fromString(t,{allowRounding:!0})}static _fromString(t,r){let n=!1,i=!1,s=!1,h=!1,a=0,o=0,N=0,g=0,f=0,u=[0],b=0,S=0,I=0,U=0,z=new y(0,0),$=new y(0,0),P=0,p=0;if(t.length>=7e3)throw new c(""+t+" not a valid Decimal128 string");let E=t.match(bn),d=t.match(pn),Y=t.match(Sn);if(!E&&!d&&!Y||t.length===0)throw new c(""+t+" not a valid Decimal128 string");if(E){let w=E[2],L=E[4],F=E[5],R=E[6];L&&R===void 0&&C(t,"missing exponent power"),L&&w===void 0&&C(t,"missing exponent base"),L===void 0&&(F||R)&&C(t,"missing e before exponent")}if((t[p]==="+"||t[p]==="-")&&(i=!0,n=t[p++]==="-"),!Ne(t[p])&&t[p]!=="."){if(t[p]==="i"||t[p]==="I")return new e(n?pe:Se);if(t[p]==="N")return new e(Rt)}for(;Ne(t[p])||t[p]===".";){if(t[p]==="."){s&&C(t,"contains multiple periods"),s=!0,p=p+1;continue}b<be&&(t[p]!=="0"||h)&&(h||(f=o),h=!0,u[S++]=parseInt(t[p],10),b=b+1),h&&(N=N+1),s&&(g=g+1),o=o+1,p=p+1}if(s&&!o)throw new c(""+t+" not a valid Decimal128 string");if(t[p]==="e"||t[p]==="E"){let w=t.substr(++p).match(Bn);if(!w||!w[2])return new e(Rt);U=parseInt(w[0],10),p=p+w[0].length}if(t[p])return new e(Rt);if(!b)u[0]=0,N=1,b=1,a=0;else if(I=b-1,a=N,a!==1)for(;t[f+a-1+Number(i)+Number(s)]==="0";)a=a-1;for(U<=g&&g>U+16384?U=bt:U=U-g;U>it;){if(I=I+1,I>=be){if(a===0){U=it;break}C(t,"overflow")}U=U-1}if(r.allowRounding){for(;U<bt||b<N;){if(I===0&&a<b){U=bt,a=0;break}if(b<N?N=N-1:I=I-1,U<it)U=U+1;else{if(u.join("").match(/^0+$/)){U=it;break}C(t,"overflow")}}if(I+1<a){let w=o;s&&(f=f+1,w=w+1),i&&(f=f+1,w=w+1);let L=parseInt(t[f+I+1],10),F=0;if(L>=5&&(F=1,L===5)){F=u[I]%2===1?1:0;for(let R=f+I+2;R<w;R++)if(parseInt(t[R],10)){F=1;break}}if(F){let R=I;for(;R>=0&&++u[R]>9;R--)if(u[R]=0,R===0)if(U<it)U=U+1,u[R]=1;else return new e(n?pe:Se)}}}else{for(;U<bt||b<N;){if(I===0){if(a===0){U=bt;break}C(t,"exponent underflow")}b<N?(t[N-1+Number(i)+Number(s)]!=="0"&&a!==0&&C(t,"inexact rounding"),N=N-1):(u[I]!==0&&C(t,"inexact rounding"),I=I-1),U<it?U=U+1:C(t,"overflow")}I+1<a&&(s&&(f=f+1),i&&(f=f+1),parseInt(t[f+I+1],10)!==0&&C(t,"inexact rounding"))}if(z=y.fromNumber(0),$=y.fromNumber(0),a===0)z=y.fromNumber(0),$=y.fromNumber(0);else if(I<17){let w=0;for($=y.fromNumber(u[w++]),z=new y(0,0);w<=I;w++)$=$.multiply(y.fromNumber(10)),$=$.add(y.fromNumber(u[w]))}else{let w=0;for(z=y.fromNumber(u[w++]);w<=I-17;w++)z=z.multiply(y.fromNumber(10)),z=z.add(y.fromNumber(u[w]));for($=y.fromNumber(u[w++]);w<=I;w++)$=$.multiply(y.fromNumber(10)),$=$.add(y.fromNumber(u[w]))}let D=In(z,y.fromString("100000000000000000"));D.low=D.low.add($),Tn(D.low,$)&&(D.high=D.high.add(y.fromNumber(1))),P=U+we;let B={low:y.fromNumber(0),high:y.fromNumber(0)};D.high.shiftRightUnsigned(49).and(y.fromNumber(1)).equals(y.fromNumber(1))?(B.high=B.high.or(y.fromNumber(3).shiftLeft(61)),B.high=B.high.or(y.fromNumber(P).and(y.fromNumber(16383).shiftLeft(47))),B.high=B.high.or(D.high.and(y.fromNumber(0x7fffffffffff)))):(B.high=B.high.or(y.fromNumber(P&16383).shiftLeft(49)),B.high=B.high.or(D.high.and(y.fromNumber(562949953421311)))),B.low=D.low,n&&(B.high=B.high.or(y.fromString("9223372036854775808")));let m=l.allocateUnsafe(16);return p=0,m[p++]=B.low.low&255,m[p++]=B.low.low>>8&255,m[p++]=B.low.low>>16&255,m[p++]=B.low.low>>24&255,m[p++]=B.low.high&255,m[p++]=B.low.high>>8&255,m[p++]=B.low.high>>16&255,m[p++]=B.low.high>>24&255,m[p++]=B.high.low&255,m[p++]=B.high.low>>8&255,m[p++]=B.high.low>>16&255,m[p++]=B.high.low>>24&255,m[p++]=B.high.high&255,m[p++]=B.high.high>>8&255,m[p++]=B.high.high>>16&255,m[p++]=B.high.high>>24&255,new e(m)}toString(){let t,r=0,n=new Array(36);for(let p=0;p<n.length;p++)n[p]=0;let i=0,s=!1,h,a={parts:[0,0,0,0]},o,N,g=[];i=0;let f=this.bytes,u=f[i++]|f[i++]<<8|f[i++]<<16|f[i++]<<24,b=f[i++]|f[i++]<<8|f[i++]<<16|f[i++]<<24,S=f[i++]|f[i++]<<8|f[i++]<<16|f[i++]<<24,I=f[i++]|f[i++]<<8|f[i++]<<16|f[i++]<<24;i=0,{low:new y(u,b),high:new y(S,I)}.high.lessThan(y.ZERO)&&g.push("-");let z=I>>26&Nn;if(z>>3===3){if(z===En)return g.join("")+"Infinity";if(z===On)return"NaN";t=I>>15&Be,h=8+(I>>14&1)}else h=I>>14&7,t=I>>17&Be;let $=t-we;if(a.parts[0]=(I&16383)+((h&15)<<14),a.parts[1]=S,a.parts[2]=b,a.parts[3]=u,a.parts[0]===0&&a.parts[1]===0&&a.parts[2]===0&&a.parts[3]===0)s=!0;else for(N=3;N>=0;N--){let p=0,E=dn(a);if(a=E.quotient,p=E.rem.low,!!p)for(o=8;o>=0;o--)n[N*9+o]=p%10,p=Math.floor(p/10)}if(s)r=1,n[i]=0;else for(r=36;!n[i];)r=r-1,i=i+1;let P=r-1+$;if(P>=34||P<=-7||$>0){if(r>34)return g.push("0"),$>0?g.push(`E+${$}`):$<0&&g.push(`E${$}`),g.join("");g.push(`${n[i++]}`),r=r-1,r&&g.push(".");for(let p=0;p<r;p++)g.push(`${n[i++]}`);g.push("E"),P>0?g.push(`+${P}`):g.push(`${P}`)}else if($>=0)for(let p=0;p<r;p++)g.push(`${n[i++]}`);else{let p=r+$;if(p>0)for(let E=0;E<p;E++)g.push(`${n[i++]}`);else g.push("0");for(g.push(".");p++<0;)g.push("0");for(let E=0;E<r-Math.max(p-1,0);E++)g.push(`${n[i++]}`)}return g.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(t){return e.fromString(t.$numberDecimal)}inspect(t,r,n){return n??=x,`new Decimal128(${n(this.toString(),r)})`}},et=class e extends j{get _bsontype(){return"Double"}constructor(t){super(),t instanceof Number&&(t=t.valueOf()),this.value=+t}static fromString(t){let r=Number(t);if(t==="NaN")return new e(NaN);if(t==="Infinity")return new e(1/0);if(t==="-Infinity")return new e(-1/0);if(!Number.isFinite(r))throw new c(`Input: ${t} is not representable as a Double`);if(t.trim()!==t)throw new c(`Input: '${t}' contains whitespace`);if(t==="")throw new c("Input is an empty string");if(/[^-0-9.+eE]/.test(t))throw new c(`Input: '${t}' is not in decimal or exponential notation`);return new e(r)}valueOf(){return this.value}toJSON(){return this.value}toString(t){return this.value.toString(t)}toExtendedJSON(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(t,r){let n=parseFloat(t.$numberDouble);return r&&r.relaxed?n:new e(n)}inspect(t,r,n){return n??=x,`new Double(${n(this.value,r)})`}},nt=class e extends j{get _bsontype(){return"Int32"}constructor(t){super(),t instanceof Number&&(t=t.valueOf()),this.value=+t|0}static fromString(t){let r=Je(t),n=Number(t);if(Et<n)throw new c(`Input: '${t}' is larger than the maximum value for Int32`);if(Ot>n)throw new c(`Input: '${t}' is smaller than the minimum value for Int32`);if(Number.isSafeInteger(n)){if(n.toString()!==r)throw new c(`Input: '${t}' is not a valid Int32 string`)}else throw new c(`Input: '${t}' is not a safe integer`);return new e(n)}valueOf(){return this.value}toString(t){return this.value.toString(t)}toJSON(){return this.value}toExtendedJSON(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)}inspect(t,r,n){return n??=x,`new Int32(${n(this.value,r)})`}},gt=class e extends j{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new e}inspect(){return"new MaxKey()"}},yt=class e extends j{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new e}inspect(){return"new MinKey()"}},Q=null,pt=new WeakMap,G=class e extends j{get _bsontype(){return"ObjectId"}constructor(t){super();let r;if(typeof t=="object"&&t&&"id"in t){if(typeof t.id!="string"&&!ArrayBuffer.isView(t.id))throw new c("Argument passed in must have an id that is of type string or Buffer");"toHexString"in t&&typeof t.toHexString=="function"?r=l.fromHex(t.toHexString()):r=t.id}else r=t;if(r==null||typeof r=="number")this.buffer=e.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this.buffer=l.toLocalBufferType(r);else if(typeof r=="string")if(e.validateHexString(r))this.buffer=l.fromHex(r),e.cacheHexString&&pt.set(this,r);else throw new c("input must be a 24 character hex string, 12 byte Uint8Array, or an integer");else throw new c("Argument passed in does not match the accepted types")}get id(){return this.buffer}set id(t){this.buffer=t,e.cacheHexString&&pt.set(this,l.toHex(t))}static validateHexString(t){if(t?.length!==24)return!1;for(let r=0;r<24;r++){let n=t.charCodeAt(r);if(!(n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70))return!1}return!0}toHexString(){if(e.cacheHexString){let r=pt.get(this);if(r)return r}let t=l.toHex(this.id);return e.cacheHexString&&pt.set(this,t),t}static getInc(){return e.index=(e.index+1)%16777215}static generate(t){typeof t!="number"&&(t=Math.floor(Date.now()/1e3));let r=e.getInc(),n=l.allocateUnsafe(12);return O.setInt32BE(n,0,t),Q===null&&(Q=l.randomBytes(5)),n[4]=Q[0],n[5]=Q[1],n[6]=Q[2],n[7]=Q[3],n[8]=Q[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n}toString(t){return t==="base64"?l.toBase64(this.id):t==="hex"?this.toHexString():this.toHexString()}toJSON(){return this.toHexString()}static is(t){return t!=null&&typeof t=="object"&&"_bsontype"in t&&t._bsontype==="ObjectId"}equals(t){if(t==null)return!1;if(e.is(t))return this.buffer[11]===t.buffer[11]&&l.equals(this.buffer,t.buffer);if(typeof t=="string")return t.toLowerCase()===this.toHexString();if(typeof t=="object"&&typeof t.toHexString=="function"){let r=t.toHexString(),n=this.toHexString();return typeof r=="string"&&r.toLowerCase()===n}return!1}getTimestamp(){let t=new Date,r=O.getUint32BE(this.buffer,0);return t.setTime(Math.floor(r)*1e3),t}static createPk(){return new e}serializeInto(t,r){return t[r]=this.buffer[0],t[r+1]=this.buffer[1],t[r+2]=this.buffer[2],t[r+3]=this.buffer[3],t[r+4]=this.buffer[4],t[r+5]=this.buffer[5],t[r+6]=this.buffer[6],t[r+7]=this.buffer[7],t[r+8]=this.buffer[8],t[r+9]=this.buffer[9],t[r+10]=this.buffer[10],t[r+11]=this.buffer[11],12}static createFromTime(t){let r=l.allocate(12);for(let n=11;n>=4;n--)r[n]=0;return O.setInt32BE(r,0,t),new e(r)}static createFromHexString(t){if(t?.length!==24)throw new c("hex string must be 24 characters");return new e(l.fromHex(t))}static createFromBase64(t){if(t?.length!==16)throw new c("base64 string must be 16 characters");return new e(l.fromBase64(t))}static isValid(t){if(t==null)return!1;if(typeof t=="string")return e.validateHexString(t);try{return new e(t),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(t){return new e(t.$oid)}isCached(){return e.cacheHexString&&pt.has(this)}inspect(t,r,n){return n??=x,`new ObjectId(${n(this.toHexString(),r)})`}};G.index=Math.floor(Math.random()*16777215);function Tt(e,t,r){let n=5;if(Array.isArray(e))for(let i=0;i<e.length;i++)n+=Ee(i.toString(),e[i],t,!0,r);else{typeof e?.toBSON=="function"&&(e=e.toBSON());for(let i of Object.keys(e))n+=Ee(i,e[i],t,!1,r)}return n}function Ee(e,t,r=!1,n=!1,i=!1){switch(typeof t?.toBSON=="function"&&(t=t.toBSON()),typeof t){case"string":return 1+l.utf8ByteLength(e)+1+4+l.utf8ByteLength(t)+1;case"number":return Math.floor(t)===t&&t>=$e&&t<=Le&&t>=Ot&&t<=Et?(e!=null?l.utf8ByteLength(e)+1:0)+5:(e!=null?l.utf8ByteLength(e)+1:0)+9;case"undefined":return n||!i?(e!=null?l.utf8ByteLength(e)+1:0)+1:0;case"boolean":return(e!=null?l.utf8ByteLength(e)+1:0)+2;case"object":if(t!=null&&typeof t._bsontype=="string"&&t[at]!==v)throw new q;if(t==null||t._bsontype==="MinKey"||t._bsontype==="MaxKey")return(e!=null?l.utf8ByteLength(e)+1:0)+1;if(t._bsontype==="ObjectId")return(e!=null?l.utf8ByteLength(e)+1:0)+13;if(t instanceof Date||lt(t))return(e!=null?l.utf8ByteLength(e)+1:0)+9;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||ee(t))return(e!=null?l.utf8ByteLength(e)+1:0)+6+t.byteLength;if(t._bsontype==="Long"||t._bsontype==="Double"||t._bsontype==="Timestamp")return(e!=null?l.utf8ByteLength(e)+1:0)+9;if(t._bsontype==="Decimal128")return(e!=null?l.utf8ByteLength(e)+1:0)+17;if(t._bsontype==="Code")return t.scope!=null&&Object.keys(t.scope).length>0?(e!=null?l.utf8ByteLength(e)+1:0)+1+4+4+l.utf8ByteLength(t.code.toString())+1+Tt(t.scope,r,i):(e!=null?l.utf8ByteLength(e)+1:0)+1+4+l.utf8ByteLength(t.code.toString())+1;if(t._bsontype==="Binary"){let s=t;return s.sub_type===T.SUBTYPE_BYTE_ARRAY?(e!=null?l.utf8ByteLength(e)+1:0)+(s.position+1+4+1+4):(e!=null?l.utf8ByteLength(e)+1:0)+(s.position+1+4+1)}else{if(t._bsontype==="Symbol")return(e!=null?l.utf8ByteLength(e)+1:0)+l.utf8ByteLength(t.value)+4+1+1;if(t._bsontype==="DBRef"){let s=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return t.db!=null&&(s.$db=t.db),(e!=null?l.utf8ByteLength(e)+1:0)+1+Tt(s,r,i)}else return t instanceof RegExp||ft(t)?(e!=null?l.utf8ByteLength(e)+1:0)+1+l.utf8ByteLength(t.source)+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t._bsontype==="BSONRegExp"?(e!=null?l.utf8ByteLength(e)+1:0)+1+l.utf8ByteLength(t.pattern)+1+l.utf8ByteLength(t.options)+1:(e!=null?l.utf8ByteLength(e)+1:0)+Tt(t,r,i)+1}case"function":return r?(e!=null?l.utf8ByteLength(e)+1:0)+1+4+l.utf8ByteLength(t.toString())+1:0;case"bigint":return(e!=null?l.utf8ByteLength(e)+1:0)+9;case"symbol":return 0;default:throw new c(`Unrecognized JS type: ${typeof t}`)}}function Ln(e){return e.split("").sort().join("")}var X=class e extends j{get _bsontype(){return"BSONRegExp"}constructor(t,r){if(super(),this.pattern=t,this.options=Ln(r??""),this.pattern.indexOf("\0")!==-1)throw new c(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(this.options.indexOf("\0")!==-1)throw new c(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new c(`The regular expression option [${this.options[n]}] is not supported`)}static parseOptions(t){return t?t.split("").sort().join(""):""}toExtendedJSON(t){return t=t||{},t.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(t){if("$regex"in t)if(typeof t.$regex!="string"){if(t.$regex._bsontype==="BSONRegExp")return t}else return new e(t.$regex,e.parseOptions(t.$options));if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new c(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(t)}`)}inspect(t,r,n){let i=ve(r)??(a=>a);n??=x;let s=i(n(this.pattern),"regexp"),h=i(n(this.options),"regexp");return`new BSONRegExp(${s}, ${h})`}},mt=class e extends j{get _bsontype(){return"BSONSymbol"}constructor(t){super(),this.value=t}valueOf(){return this.value}toString(){return this.value}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(t){return new e(t.$symbol)}inspect(t,r,n){return n??=x,`new BSONSymbol(${n(this.value,r)})`}},$n=y,rt=class e extends $n{get _bsontype(){return"Timestamp"}get i(){return this.low>>>0}get t(){return this.high>>>0}constructor(t){if(t==null)super(0,0,!0);else if(typeof t=="bigint")super(t,!0);else if(y.isLong(t))super(t.low,t.high,!0);else if(typeof t=="object"&&"t"in t&&"i"in t){if(typeof t.t!="number"&&(typeof t.t!="object"||t.t._bsontype!=="Int32"))throw new c("Timestamp constructed from { t, i } must provide t as a number");if(typeof t.i!="number"&&(typeof t.i!="object"||t.i._bsontype!=="Int32"))throw new c("Timestamp constructed from { t, i } must provide i as a number");let r=Number(t.t),n=Number(t.i);if(r<0||Number.isNaN(r))throw new c("Timestamp constructed from { t, i } must provide a positive t");if(n<0||Number.isNaN(n))throw new c("Timestamp constructed from { t, i } must provide a positive i");if(r>4294967295)throw new c("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(n>4294967295)throw new c("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(n,r,!0)}else throw new c("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(t){return new e(y.fromInt(t,!0))}static fromNumber(t){return new e(y.fromNumber(t,!0))}static fromBits(t,r){return new e({i:t,t:r})}static fromString(t,r){return new e(y.fromString(t,!0,r))}toExtendedJSON(){return{$timestamp:{t:this.t,i:this.i}}}static fromExtendedJSON(t){let r=y.isLong(t.$timestamp.i)?t.$timestamp.i.getLowBitsUnsigned():t.$timestamp.i,n=y.isLong(t.$timestamp.t)?t.$timestamp.t.getLowBitsUnsigned():t.$timestamp.t;return new e({t:n,i:r})}inspect(t,r,n){n??=x;let i=n(this.t,r),s=n(this.i,r);return`new Timestamp({ t: ${i}, i: ${s} })`}};rt.MAX_VALUE=y.MAX_UNSIGNED_VALUE;var An=y.fromNumber(Le),Un=y.fromNumber($e);function ke(e,t,r){t=t??{};let n=t&&t.index?t.index:0,i=O.getInt32LE(e,n);if(i<5)throw new c(`bson size must be >= 5, is ${i}`);if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new c(`buffer length ${e.length} must be >= bson size ${i}`);if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new c(`buffer length ${e.length} must === bson size ${i}`);if(i+n>e.byteLength)throw new c(`(bson size ${i} + options.index ${n} must be <= buffer length ${e.byteLength})`);if(e[n+i-1]!==0)throw new c("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Lt(e,n,t,r)}var _n=/^\$ref$|^\$id$|^\$db$/;function Lt(e,t,r,n=!1){let i=r.fieldsAsRaw==null?null:r.fieldsAsRaw,s=r.raw==null?!1:r.raw,h=typeof r.bsonRegExp=="boolean"?r.bsonRegExp:!1,a=r.promoteBuffers??!1,o=r.promoteLongs??!0,N=r.promoteValues??!0,g=r.useBigInt64??!1;if(g&&!N)throw new c("Must either request bigint or Long for int64 deserialization");if(g&&!o)throw new c("Must either request bigint or Long for int64 deserialization");let f=r.validation==null?{utf8:!0}:r.validation,u=!0,b,S,I=f.utf8;if(typeof I=="boolean")b=I;else{u=!1;let E=Object.keys(I).map(function(d){return I[d]});if(E.length===0)throw new c("UTF-8 validation setting cannot be empty");if(typeof E[0]!="boolean")throw new c("Invalid UTF-8 validation option, must specify boolean values");if(b=E[0],!E.every(d=>d===b))throw new c("Invalid UTF-8 validation option - keys must be all true or all false")}if(!u){S=new Set;for(let E of Object.keys(I))S.add(E)}let U=t;if(e.length<5)throw new c("corrupt bson message < 5 bytes long");let z=O.getInt32LE(e,t);if(t+=4,z<5||z>e.length)throw new c("corrupt bson message");let $=n?[]:{},P=0,p=n?!1:null;for(;;){let E=e[t++];if(E===0)break;let d=t;for(;e[d]!==0&&d<e.length;)d++;if(d>=e.byteLength)throw new c("Bad BSON Document: illegal CString");let Y=n?P++:l.toUTF8(e,t,d,!1),D=!0;u||S?.has(Y)?D=b:D=!b,p!==!1&&Y[0]==="$"&&(p=_n.test(Y));let B;if(t=d+1,E===Ae){let m=O.getInt32LE(e,t);if(t+=4,m<=0||m>e.length-t||e[t+m-1]!==0)throw new c("bad string length in bson");B=l.toUTF8(e,t,t+m-1,D),t=t+m}else if(E===_e){let m=l.allocateUnsafe(12);for(let w=0;w<12;w++)m[w]=e[t+w];B=new G(m),t=t+12}else if(E===St&&N===!1)B=new nt(O.getInt32LE(e,t)),t+=4;else if(E===St)B=O.getInt32LE(e,t),t+=4;else if(E===re)B=O.getFloat64LE(e,t),t+=8,N===!1&&(B=new et(B));else if(E===De){let m=O.getInt32LE(e,t),w=O.getInt32LE(e,t+4);t+=8,B=new Date(new y(m,w).toNumber())}else if(E===Re){if(e[t]!==0&&e[t]!==1)throw new c("illegal boolean type value");B=e[t++]===1}else if(E===ie){let m=t,w=O.getInt32LE(e,t);if(w<=0||w>e.length-t)throw new c("bad embedded document length in bson");if(s)B=e.subarray(t,t+w);else{let L=r;u||(L={...r,validation:{utf8:D}}),B=Lt(e,m,L,!1)}t=t+w}else if(E===Ue){let m=t,w=O.getInt32LE(e,t),L=r,F=t+w;if(i&&i[Y]&&(L={...r,raw:!0}),u||(L={...L,validation:{utf8:D}}),B=Lt(e,m,L,!0),t=t+w,e[t-1]!==0)throw new c("invalid array terminator byte");if(t!==F)throw new c("corrupted array bson")}else if(E===tn)B=void 0;else if(E===oe)B=null;else if(E===le)if(g)B=O.getBigInt64LE(e,t),t+=8;else{let m=O.getInt32LE(e,t),w=O.getInt32LE(e,t+4);t+=8;let L=new y(m,w);o&&N===!0?B=L.lessThanOrEqual(An)&&L.greaterThanOrEqual(Un)?L.toNumber():L:B=L}else if(E===Fe){let m=l.allocateUnsafe(16);for(let w=0;w<16;w++)m[w]=e[t+w];t=t+16,B=new ut(m)}else if(E===se){let m=O.getInt32LE(e,t);t+=4;let w=m,L=e[t++];if(m<0)throw new c("Negative binary type element size found");if(m>e.byteLength)throw new c("Binary type size larger than document size");if(L===T.SUBTYPE_BYTE_ARRAY){if(m=O.getInt32LE(e,t),t+=4,m<0)throw new c("Negative binary type element size found for subtype 0x02");if(m>w-4)throw new c("Binary type with subtype 0x02 contains too long binary size");if(m<w-4)throw new c("Binary type with subtype 0x02 contains too short binary size")}a&&N?B=l.toLocalBufferType(e.subarray(t,t+m)):(B=new T(e.subarray(t,t+m),L),L===ce&&tt.isValid(B)&&(B=B.toUUID())),t=t+m}else if(E===$t&&h===!1){for(d=t;e[d]!==0&&d<e.length;)d++;if(d>=e.length)throw new c("Bad BSON Document: illegal CString");let m=l.toUTF8(e,t,d,!1);for(t=d+1,d=t;e[d]!==0&&d<e.length;)d++;if(d>=e.length)throw new c("Bad BSON Document: illegal CString");let w=l.toUTF8(e,t,d,!1);t=d+1;let L=new Array(w.length);for(d=0;d<w.length;d++)switch(w[d]){case"m":L[d]="m";break;case"s":L[d]="g";break;case"i":L[d]="i";break}B=new RegExp(m,L.join(""))}else if(E===$t&&h===!0){for(d=t;e[d]!==0&&d<e.length;)d++;if(d>=e.length)throw new c("Bad BSON Document: illegal CString");let m=l.toUTF8(e,t,d,!1);for(t=d+1,d=t;e[d]!==0&&d<e.length;)d++;if(d>=e.length)throw new c("Bad BSON Document: illegal CString");let w=l.toUTF8(e,t,d,!1);t=d+1,B=new X(m,w)}else if(E===ze){let m=O.getInt32LE(e,t);if(t+=4,m<=0||m>e.length-t||e[t+m-1]!==0)throw new c("bad string length in bson");let w=l.toUTF8(e,t,t+m-1,D);B=N?w:new mt(w),t=t+m}else if(E===xe)B=new rt({i:O.getUint32LE(e,t),t:O.getUint32LE(e,t+4)}),t+=8;else if(E===Me)B=new yt;else if(E===Pe)B=new gt;else if(E===fe){let m=O.getInt32LE(e,t);if(t+=4,m<=0||m>e.length-t||e[t+m-1]!==0)throw new c("bad string length in bson");let w=l.toUTF8(e,t,t+m-1,D);B=new K(w),t=t+m}else if(E===je){let m=O.getInt32LE(e,t);if(t+=4,m<13)throw new c("code_w_scope total size shorter minimum expected length");let w=O.getInt32LE(e,t);if(t+=4,w<=0||w>e.length-t||e[t+w-1]!==0)throw new c("bad string length in bson");let L=l.toUTF8(e,t,t+w-1,D);t=t+w;let F=t,R=O.getInt32LE(e,t),Ge=Lt(e,F,r,!1);if(t=t+R,m<8+R+w)throw new c("code_w_scope total size is too short, truncating scope");if(m>8+R+w)throw new c("code_w_scope total size is too long, clips outer document");B=new K(L,Ge)}else if(E===en){let m=O.getInt32LE(e,t);if(t+=4,m<=0||m>e.length-t||e[t+m-1]!==0)throw new c("bad string length in bson");let w=l.toUTF8(e,t,t+m-1,D);t=t+m;let L=l.allocateUnsafe(12);for(let R=0;R<12;R++)L[R]=e[t+R];let F=new G(L);t=t+12,B=new k(w,F)}else throw new c(`Detected unknown BSON type ${E.toString(16)} for fieldname "${Y}"`);Y==="__proto__"?Object.defineProperty($,Y,{value:B,writable:!0,enumerable:!0,configurable:!0}):$[Y]=B}if(z!==t-U)throw n?new c("corrupt array bson"):new c("corrupt object bson");if(!p)return $;if(Ye($)){let E=Object.assign({},$);return delete E.$ref,delete E.$id,delete E.$db,new k($.$ref,$.$id,$.$db,E)}return $}var At=/\x00/,Oe=new Set(["$db","$ref","$id","$clusterTime"]);function Dt(e,t,r,n){e[n++]=Ae;let i=l.encodeUTF8Into(e,t,n);n=n+i+1,e[n-1]=0;let s=l.encodeUTF8Into(e,r,n+4);return O.setInt32LE(e,n,s+1),n=n+4+s,e[n++]=0,n}function zt(e,t,r,n){let s=!Object.is(r,-0)&&Number.isSafeInteger(r)&&r<=Et&&r>=Ot?St:re;e[n++]=s;let h=l.encodeUTF8Into(e,t,n);return n=n+h,e[n++]=0,s===St?n+=O.setInt32LE(e,n,r):n+=O.setFloat64LE(e,n,r),n}function jt(e,t,r,n){e[n++]=le;let i=l.encodeUTF8Into(e,t,n);return n+=i,e[n++]=0,n+=O.setBigInt64LE(e,n,r),n}function st(e,t,r,n){e[n++]=oe;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,n}function xt(e,t,r,n){e[n++]=Re;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,e[n++]=r?1:0,n}function Ft(e,t,r,n){e[n++]=De;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=y.fromNumber(r.getTime()),h=s.getLowBits(),a=s.getHighBits();return n+=O.setInt32LE(e,n,h),n+=O.setInt32LE(e,n,a),n}function Mt(e,t,r,n){e[n++]=$t;let i=l.encodeUTF8Into(e,t,n);if(n=n+i,e[n++]=0,r.source&&r.source.match(At)!=null)throw new c("value "+r.source+" must not contain null bytes");return n=n+l.encodeUTF8Into(e,r.source,n),e[n++]=0,r.ignoreCase&&(e[n++]=105),r.global&&(e[n++]=115),r.multiline&&(e[n++]=109),e[n++]=0,n}function Pt(e,t,r,n){e[n++]=$t;let i=l.encodeUTF8Into(e,t,n);if(n=n+i,e[n++]=0,r.pattern.match(At)!=null)throw new c("pattern "+r.pattern+" must not contain null bytes");n=n+l.encodeUTF8Into(e,r.pattern,n),e[n++]=0;let s=r.options.split("").sort().join("");return n=n+l.encodeUTF8Into(e,s,n),e[n++]=0,n}function Ct(e,t,r,n){r===null?e[n++]=oe:r._bsontype==="MinKey"?e[n++]=Me:e[n++]=Pe;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,n}function Vt(e,t,r,n){e[n++]=_e;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,n+=r.serializeInto(e,n),n}function Yt(e,t,r,n){e[n++]=se;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=r.length;if(n+=O.setInt32LE(e,n,s),e[n++]=nn,s<=16)for(let h=0;h<s;h++)e[n+h]=r[h];else e.set(r,n);return n=n+s,n}function Jt(e,t,r,n,i,s,h,a,o){if(o.has(r))throw new c("Cannot convert circular structure to BSON");o.add(r),e[n++]=Array.isArray(r)?Ue:ie;let N=l.encodeUTF8Into(e,t,n);n=n+N,e[n++]=0;let g=dt(e,r,i,n,s+1,h,a,o);return o.delete(r),g}function Ht(e,t,r,n){e[n++]=Fe;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;for(let s=0;s<16;s++)e[n+s]=r.bytes[s];return n+16}function kt(e,t,r,n){e[n++]=r._bsontype==="Long"?le:xe;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=r.getLowBits(),h=r.getHighBits();return n+=O.setInt32LE(e,n,s),n+=O.setInt32LE(e,n,h),n}function Wt(e,t,r,n){r=r.valueOf(),e[n++]=St;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,n+=O.setInt32LE(e,n,r),n}function Zt(e,t,r,n){e[n++]=re;let i=l.encodeUTF8Into(e,t,n);return n=n+i,e[n++]=0,n+=O.setFloat64LE(e,n,r.value),n}function qt(e,t,r,n){e[n++]=fe;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=r.toString(),h=l.encodeUTF8Into(e,s,n+4)+1;return O.setInt32LE(e,n,h),n=n+4+h-1,e[n++]=0,n}function Kt(e,t,r,n,i=!1,s=0,h=!1,a=!0,o){if(r.scope&&typeof r.scope=="object"){e[n++]=je;let N=l.encodeUTF8Into(e,t,n);n=n+N,e[n++]=0;let g=n,f=r.code;n=n+4;let u=l.encodeUTF8Into(e,f,n+4)+1;O.setInt32LE(e,n,u),e[n+4+u-1]=0,n=n+u+4;let b=dt(e,r.scope,i,n,s+1,h,a,o);n=b-1;let S=b-g;g+=O.setInt32LE(e,g,S),e[n++]=0}else{e[n++]=fe;let N=l.encodeUTF8Into(e,t,n);n=n+N,e[n++]=0;let g=r.code.toString(),f=l.encodeUTF8Into(e,g,n+4)+1;O.setInt32LE(e,n,f),n=n+4+f-1,e[n++]=0}return n}function Gt(e,t,r,n){e[n++]=se;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=r.buffer,h=r.position;if(r.sub_type===T.SUBTYPE_BYTE_ARRAY&&(h=h+4),n+=O.setInt32LE(e,n,h),e[n++]=r.sub_type,r.sub_type===T.SUBTYPE_BYTE_ARRAY&&(h=h-4,n+=O.setInt32LE(e,n,h)),r.sub_type===T.SUBTYPE_VECTOR&&J(r),h<=16)for(let a=0;a<h;a++)e[n+a]=s[a];else e.set(s,n);return n=n+r.position,n}function Xt(e,t,r,n){e[n++]=ze;let i=l.encodeUTF8Into(e,t,n);n=n+i,e[n++]=0;let s=l.encodeUTF8Into(e,r.value,n+4)+1;return O.setInt32LE(e,n,s),n=n+4+s-1,e[n++]=0,n}function Qt(e,t,r,n,i,s,h){e[n++]=ie;let a=l.encodeUTF8Into(e,t,n);n=n+a,e[n++]=0;let o=n,N={$ref:r.collection||r.namespace,$id:r.oid};r.db!=null&&(N.$db=r.db),N=Object.assign(N,r.fields);let g=dt(e,N,!1,n,i+1,s,!0,h),f=g-o;return o+=O.setInt32LE(e,n,f),g}function dt(e,t,r,n,i,s,h,a){if(a==null){if(t==null)return e[0]=5,e[1]=0,e[2]=0,e[3]=0,e[4]=0,5;if(Array.isArray(t))throw new c("serialize does not support an array as the root input");if(typeof t!="object")throw new c("serialize does not support non-object as the root input");if("_bsontype"in t&&typeof t._bsontype=="string")throw new c("BSON types cannot be serialized as a document");if(lt(t)||ft(t)||ot(t)||ee(t))throw new c("date, regexp, typedarray, and arraybuffer cannot be BSON documents");a=new Set}a.add(t);let o=n+4;if(Array.isArray(t))for(let g=0;g<t.length;g++){let f=`${g}`,u=t[g];typeof u?.toBSON=="function"&&(u=u.toBSON());let b=typeof u;if(u===void 0)o=st(e,f,u,o);else if(u===null)o=st(e,f,u,o);else if(b==="string")o=Dt(e,f,u,o);else if(b==="number")o=zt(e,f,u,o);else if(b==="bigint")o=jt(e,f,u,o);else if(b==="boolean")o=xt(e,f,u,o);else if(b==="object"&&u._bsontype==null)u instanceof Date||lt(u)?o=Ft(e,f,u,o):u instanceof Uint8Array||ot(u)?o=Yt(e,f,u,o):u instanceof RegExp||ft(u)?o=Mt(e,f,u,o):o=Jt(e,f,u,o,r,i,s,h,a);else if(b==="object"){if(u[at]!==v)throw new q;if(u._bsontype==="ObjectId")o=Vt(e,f,u,o);else if(u._bsontype==="Decimal128")o=Ht(e,f,u,o);else if(u._bsontype==="Long"||u._bsontype==="Timestamp")o=kt(e,f,u,o);else if(u._bsontype==="Double")o=Zt(e,f,u,o);else if(u._bsontype==="Code")o=Kt(e,f,u,o,r,i,s,h,a);else if(u._bsontype==="Binary")o=Gt(e,f,u,o);else if(u._bsontype==="BSONSymbol")o=Xt(e,f,u,o);else if(u._bsontype==="DBRef")o=Qt(e,f,u,o,i,s,a);else if(u._bsontype==="BSONRegExp")o=Pt(e,f,u,o);else if(u._bsontype==="Int32")o=Wt(e,f,u,o);else if(u._bsontype==="MinKey"||u._bsontype==="MaxKey")o=Ct(e,f,u,o);else if(typeof u._bsontype<"u")throw new c(`Unrecognized or invalid _bsontype: ${String(u._bsontype)}`)}else b==="function"&&s&&(o=qt(e,f,u,o))}else if(t instanceof Map||ne(t)){let g=t.entries(),f=!1;for(;!f;){let u=g.next();if(f=!!u.done,f)continue;let b=u.value?u.value[0]:void 0,S=u.value?u.value[1]:void 0;typeof S?.toBSON=="function"&&(S=S.toBSON());let I=typeof S;if(typeof b=="string"&&!Oe.has(b)){if(b.match(At)!=null)throw new c("key "+b+" must not contain null bytes");if(r){if(b[0]==="$")throw new c("key "+b+" must not start with '$'");if(b.includes("."))throw new c("key "+b+" must not contain '.'")}}if(S===void 0)h===!1&&(o=st(e,b,S,o));else if(S===null)o=st(e,b,S,o);else if(I==="string")o=Dt(e,b,S,o);else if(I==="number")o=zt(e,b,S,o);else if(I==="bigint")o=jt(e,b,S,o);else if(I==="boolean")o=xt(e,b,S,o);else if(I==="object"&&S._bsontype==null)S instanceof Date||lt(S)?o=Ft(e,b,S,o):S instanceof Uint8Array||ot(S)?o=Yt(e,b,S,o):S instanceof RegExp||ft(S)?o=Mt(e,b,S,o):o=Jt(e,b,S,o,r,i,s,h,a);else if(I==="object"){if(S[at]!==v)throw new q;if(S._bsontype==="ObjectId")o=Vt(e,b,S,o);else if(S._bsontype==="Decimal128")o=Ht(e,b,S,o);else if(S._bsontype==="Long"||S._bsontype==="Timestamp")o=kt(e,b,S,o);else if(S._bsontype==="Double")o=Zt(e,b,S,o);else if(S._bsontype==="Code")o=Kt(e,b,S,o,r,i,s,h,a);else if(S._bsontype==="Binary")o=Gt(e,b,S,o);else if(S._bsontype==="BSONSymbol")o=Xt(e,b,S,o);else if(S._bsontype==="DBRef")o=Qt(e,b,S,o,i,s,a);else if(S._bsontype==="BSONRegExp")o=Pt(e,b,S,o);else if(S._bsontype==="Int32")o=Wt(e,b,S,o);else if(S._bsontype==="MinKey"||S._bsontype==="MaxKey")o=Ct(e,b,S,o);else if(typeof S._bsontype<"u")throw new c(`Unrecognized or invalid _bsontype: ${String(S._bsontype)}`)}else I==="function"&&s&&(o=qt(e,b,S,o))}}else{if(typeof t?.toBSON=="function"&&(t=t.toBSON(),t!=null&&typeof t!="object"))throw new c("toBSON function did not return an object");for(let g of Object.keys(t)){let f=t[g];typeof f?.toBSON=="function"&&(f=f.toBSON());let u=typeof f;if(typeof g=="string"&&!Oe.has(g)){if(g.match(At)!=null)throw new c("key "+g+" must not contain null bytes");if(r){if(g[0]==="$")throw new c("key "+g+" must not start with '$'");if(g.includes("."))throw new c("key "+g+" must not contain '.'")}}if(f===void 0)h===!1&&(o=st(e,g,f,o));else if(f===null)o=st(e,g,f,o);else if(u==="string")o=Dt(e,g,f,o);else if(u==="number")o=zt(e,g,f,o);else if(u==="bigint")o=jt(e,g,f,o);else if(u==="boolean")o=xt(e,g,f,o);else if(u==="object"&&f._bsontype==null)f instanceof Date||lt(f)?o=Ft(e,g,f,o):f instanceof Uint8Array||ot(f)?o=Yt(e,g,f,o):f instanceof RegExp||ft(f)?o=Mt(e,g,f,o):o=Jt(e,g,f,o,r,i,s,h,a);else if(u==="object"){if(f[at]!==v)throw new q;if(f._bsontype==="ObjectId")o=Vt(e,g,f,o);else if(f._bsontype==="Decimal128")o=Ht(e,g,f,o);else if(f._bsontype==="Long"||f._bsontype==="Timestamp")o=kt(e,g,f,o);else if(f._bsontype==="Double")o=Zt(e,g,f,o);else if(f._bsontype==="Code")o=Kt(e,g,f,o,r,i,s,h,a);else if(f._bsontype==="Binary")o=Gt(e,g,f,o);else if(f._bsontype==="BSONSymbol")o=Xt(e,g,f,o);else if(f._bsontype==="DBRef")o=Qt(e,g,f,o,i,s,a);else if(f._bsontype==="BSONRegExp")o=Pt(e,g,f,o);else if(f._bsontype==="Int32")o=Wt(e,g,f,o);else if(f._bsontype==="MinKey"||f._bsontype==="MaxKey")o=Ct(e,g,f,o);else if(typeof f._bsontype<"u")throw new c(`Unrecognized or invalid _bsontype: ${String(f._bsontype)}`)}else u==="function"&&s&&(o=qt(e,g,f,o))}}a.delete(t),e[o++]=0;let N=o-n;return n+=O.setInt32LE(e,n,N),o}function Rn(e){return e!=null&&typeof e=="object"&&"_bsontype"in e&&typeof e._bsontype=="string"}var Dn={$oid:G,$binary:T,$uuid:T,$symbol:mt,$numberInt:nt,$numberDecimal:ut,$numberDouble:et,$numberLong:y,$minKey:yt,$maxKey:gt,$regex:X,$regularExpression:X,$timestamp:rt};function We(e,t={}){if(typeof e=="number"){let n=e<=Et&&e>=Ot,i=e<=Ie&&e>=Te;if(t.relaxed||t.legacy)return e;if(Number.isInteger(e)&&!Object.is(e,-0)){if(n)return new nt(e);if(i)return t.useBigInt64?BigInt(e):y.fromNumber(e)}return new et(e)}if(e==null||typeof e!="object")return e;if(e.$undefined)return null;let r=Object.keys(e).filter(n=>n.startsWith("$")&&e[n]!=null);for(let n=0;n<r.length;n++){let i=Dn[r[n]];if(i)return i.fromExtendedJSON(e,t)}if(e.$date!=null){let n=e.$date,i=new Date;if(t.legacy)if(typeof n=="number")i.setTime(n);else if(typeof n=="string")i.setTime(Date.parse(n));else if(typeof n=="bigint")i.setTime(Number(n));else throw new Bt(`Unrecognized type for EJSON date: ${typeof n}`);else if(typeof n=="string")i.setTime(Date.parse(n));else if(y.isLong(n))i.setTime(n.toNumber());else if(typeof n=="number"&&t.relaxed)i.setTime(n);else if(typeof n=="bigint")i.setTime(Number(n));else throw new Bt(`Unrecognized type for EJSON date: ${typeof n}`);return i}if(e.$code!=null){let n=Object.assign({},e);return e.$scope&&(n.$scope=We(e.$scope)),K.fromExtendedJSON(e)}if(Ye(e)||e.$dbPointer){let n=e.$ref?e:e.$dbPointer;if(n instanceof k)return n;let i=Object.keys(n).filter(h=>h.startsWith("$")),s=!0;if(i.forEach(h=>{["$ref","$id","$db"].indexOf(h)===-1&&(s=!1)}),s)return k.fromExtendedJSON(n)}return e}function zn(e,t){return e.map((r,n)=>{t.seenObjects.push({propertyName:`index ${n}`,obj:null});try{return H(r,t)}finally{t.seenObjects.pop()}})}function de(e){let t=e.toISOString();return e.getUTCMilliseconds()!==0?t:t.slice(0,-5)+"Z"}function H(e,t){if(e instanceof Map||ne(e)){let r=Object.create(null);for(let[n,i]of e){if(typeof n!="string")throw new c("Can only serialize maps with string keys");r[n]=i}return H(r,t)}if((typeof e=="object"||typeof e=="function")&&e!==null){let r=t.seenObjects.findIndex(n=>n.obj===e);if(r!==-1){let n=t.seenObjects.map(g=>g.propertyName),i=n.slice(0,r).map(g=>`${g} -> `).join(""),s=n[r],h=" -> "+n.slice(r+1,n.length-1).map(g=>`${g} -> `).join(""),a=n[n.length-1],o=" ".repeat(i.length+s.length/2),N="-".repeat(h.length+(s.length+a.length)/2-1);throw new c(`Converting circular structure to EJSON:
    ${i}${s}${h}${a}
    ${o}\\${N}/`)}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return zn(e,t);if(e===void 0)return null;if(e instanceof Date||lt(e)){let r=e.getTime(),n=r>-1&&r<2534023188e5;return t.legacy?t.relaxed&&n?{$date:e.getTime()}:{$date:de(e)}:t.relaxed&&n?{$date:de(e)}:{$date:{$numberLong:e.getTime().toString()}}}if(typeof e=="number"&&(!t.relaxed||!isFinite(e))){if(Number.isInteger(e)&&!Object.is(e,-0)){if(e>=Ot&&e<=Et)return{$numberInt:e.toString()};if(e>=Te&&e<=Ie)return{$numberLong:e.toString()}}return{$numberDouble:Object.is(e,-0)?"-0.0":e.toString()}}if(typeof e=="bigint")return t.relaxed?Number(BigInt.asIntN(64,e)):{$numberLong:BigInt.asIntN(64,e).toString()};if(e instanceof RegExp||ft(e)){let r=e.flags;if(r===void 0){let i=e.toString().match(/[gimuy]*$/);i&&(r=i[0])}return new X(e.source,r).toExtendedJSON(t)}return e!=null&&typeof e=="object"?xn(e,t):e}var jn={Binary:e=>new T(e.value(),e.sub_type),Code:e=>new K(e.code,e.scope),DBRef:e=>new k(e.collection||e.namespace,e.oid,e.db,e.fields),Decimal128:e=>new ut(e.bytes),Double:e=>new et(e.value),Int32:e=>new nt(e.value),Long:e=>y.fromBits(e.low!=null?e.low:e.low_,e.low!=null?e.high:e.high_,e.low!=null?e.unsigned:e.unsigned_),MaxKey:()=>new gt,MinKey:()=>new yt,ObjectId:e=>new G(e),BSONRegExp:e=>new X(e.pattern,e.options),BSONSymbol:e=>new mt(e.value),Timestamp:e=>rt.fromBits(e.low,e.high)};function xn(e,t){if(e==null||typeof e!="object")throw new c("not an object instance");let r=e._bsontype;if(typeof r>"u"){let n={};for(let i of Object.keys(e)){t.seenObjects.push({propertyName:i,obj:null});try{let s=H(e[i],t);i==="__proto__"?Object.defineProperty(n,i,{value:s,writable:!0,enumerable:!0,configurable:!0}):n[i]=s}finally{t.seenObjects.pop()}}return n}else{if(e!=null&&typeof e=="object"&&typeof e._bsontype=="string"&&e[at]!==v)throw new q;if(Rn(e)){let n=e;if(typeof n.toExtendedJSON!="function"){let i=jn[e._bsontype];if(!i)throw new c("Unrecognized or invalid _bsontype: "+e._bsontype);n=i(n)}return r==="Code"&&n.scope?n=new K(n.code,H(n.scope,t)):r==="DBRef"&&n.oid&&(n=new k(H(n.collection,t),H(n.oid,t),H(n.db,t),H(n.fields,t))),n.toExtendedJSON(t)}else throw new c("_bsontype must be a string, but was: "+typeof r)}}function Ze(e,t){let r={useBigInt64:t?.useBigInt64??!1,relaxed:t?.relaxed??!0,legacy:t?.legacy??!1};return JSON.parse(e,(n,i)=>{if(n.indexOf("\0")!==-1)throw new c(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(n)}`);return We(i,r)})}function qe(e,t,r,n){r!=null&&typeof r=="object"&&(n=r,r=0),t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t,t=void 0,r=0);let i=Object.assign({relaxed:!0,legacy:!1},n,{seenObjects:[{propertyName:"(root)",obj:null}]}),s=H(e,i);return JSON.stringify(s,t,r)}function Fn(e,t){return t=t||{},JSON.parse(qe(e,t))}function Mn(e,t){return t=t||{},Ze(JSON.stringify(e),t)}var wt=Object.create(null);wt.parse=Ze;wt.stringify=qe;wt.serialize=Fn;wt.deserialize=Mn;Object.freeze(wt);var _={double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:255,maxKey:127};function vt(e,t){try{return O.getNonnegativeInt32LE(e,t)}catch(r){throw new V("BSON size cannot be negative",t,{cause:r})}}function te(e,t){let r=t;for(;e[r]!==0;r++);if(r===e.length-1)throw new V("Null terminator not found",t);return r}function Pn(e,t=0){if(t??=0,e.length<5)throw new V(`Input must be at least 5 bytes, got ${e.length} bytes`,t);let r=vt(e,t);if(r>e.length-t)throw new V(`Parsed documentSize (${r} bytes) does not match input length (${e.length} bytes)`,t);if(e[t+r-1]!==0)throw new V("BSON documents must end in 0x00",t+r);let n=[],i=t+4;for(;i<=r+t;){let s=e[i];if(i+=1,s===0){if(i-t!==r)throw new V("Invalid 0x00 type byte",i);break}let h=i,a=te(e,i)-h;i+=a+1;let o;if(s===_.double||s===_.long||s===_.date||s===_.timestamp)o=8;else if(s===_.int)o=4;else if(s===_.objectId)o=12;else if(s===_.decimal)o=16;else if(s===_.bool)o=1;else if(s===_.null||s===_.undefined||s===_.maxKey||s===_.minKey)o=0;else if(s===_.regex)o=te(e,te(e,i)+1)+1-i;else if(s===_.object||s===_.array||s===_.javascriptWithScope)o=vt(e,i);else if(s===_.string||s===_.binData||s===_.dbPointer||s===_.javascript||s===_.symbol)o=vt(e,i)+4,s===_.binData&&(o+=1),s===_.dbPointer&&(o+=12);else throw new V(`Invalid 0x${s.toString(16).padStart(2,"0")} type byte`,i);if(o>r)throw new V("value reports length larger than document",i);n.push([s,h,a,i,o]),i+=o}return n}var It=Object.create(null);It.parseToElements=Pn;It.ByteUtils=l;It.NumberUtils=O;Object.freeze(It);var Ke=1024*1024*17,Z=l.allocate(Ke);function Cn(e){Z.length<e&&(Z=l.allocate(e))}function Vn(e,t={}){let r=typeof t.checkKeys=="boolean"?t.checkKeys:!1,n=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,i=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0,s=typeof t.minInternalBufferSize=="number"?t.minInternalBufferSize:Ke;Z.length<s&&(Z=l.allocate(s));let h=dt(Z,e,r,0,0,n,i,null),a=l.allocateUnsafe(h);return a.set(Z.subarray(0,h),0),a}function Yn(e,t,r={}){let n=typeof r.checkKeys=="boolean"?r.checkKeys:!1,i=typeof r.serializeFunctions=="boolean"?r.serializeFunctions:!1,s=typeof r.ignoreUndefined=="boolean"?r.ignoreUndefined:!0,h=typeof r.index=="number"?r.index:0,a=dt(Z,e,n,0,0,i,s,null);return t.set(Z.subarray(0,a),h),h+a-1}function Jn(e,t={}){return ke(l.toLocalBufferType(e),t)}function Hn(e,t={}){t=t||{};let r=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,n=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0;return Tt(e,r,n)}function kn(e,t,r,n,i,s){let h=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},s),a=l.toLocalBufferType(e),o=t;for(let N=0;N<r;N++){let g=O.getInt32LE(a,o);h.index=o,n[i+N]=ke(a,h),o=o+g}return o}var Zn=Object.freeze({__proto__:null,BSONError:c,BSONOffsetError:V,BSONRegExp:X,BSONRuntimeError:Bt,BSONSymbol:mt,BSONType:rn,BSONValue:j,BSONVersionError:q,Binary:T,Code:K,DBRef:k,Decimal128:ut,Double:et,EJSON:wt,Int32:nt,Long:y,MaxKey:gt,MinKey:yt,ObjectId:G,Timestamp:rt,UUID:tt,calculateObjectSize:Hn,deserialize:Jn,deserializeStream:kn,onDemand:It,serialize:Vn,serializeWithBufferAndIndex:Yn,setInternalBufferSize:Cn});export{Zn as BSON,c as BSONError,V as BSONOffsetError,X as BSONRegExp,Bt as BSONRuntimeError,mt as BSONSymbol,rn as BSONType,j as BSONValue,q as BSONVersionError,T as Binary,K as Code,k as DBRef,ut as Decimal128,et as Double,wt as EJSON,nt as Int32,y as Long,gt as MaxKey,yt as MinKey,G as ObjectId,rt as Timestamp,tt as UUID,Hn as calculateObjectSize,Jn as deserialize,kn as deserializeStream,It as onDemand,Vn as serialize,Yn as serializeWithBufferAndIndex,Cn as setInternalBufferSize};
//# sourceMappingURL=bson.mjs.map
// denoCacheMetadata={"headers":{"cache-control":"public, max-age=31536000, immutable","content-type":"application/javascript; charset=utf-8","last-modified":"Sat, 07 Jun 2025 10:54:02 GMT","age":"438031","date":"Mon, 21 Jul 2025 21:50:29 GMT","cf-cache-status":"HIT","cf-ray":"962dea0cdb79f0be-DFW","alt-svc":"h3=\":443\"; ma=86400","server":"cloudflare","vary":"accept-encoding","access-control-allow-origin":"*"},"url":"https://esm.sh/bson@6.10.4/denonext/bson.mjs","time":1753134629}